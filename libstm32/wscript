#!/usr/bin/env python
import platform


def options(opt):
    pass

def configure(conf):
    pass

def build(bld):
    src = bld.path.ant_glob( 'src/*.c', excl=['src/crt0.c'] )
    src += bld.path.ant_glob( 'src/*.cpp', excl='src/stm32f1fmc.cpp' )
    inc = ['./inc' ]
    bld( includes = inc, export_includes= inc, name = 'com_inc3' )
    bld.objects( source='src/crt0.c', target='crt0', name= 'startup' )
    bld.stlib( source=src, target='stm32', use = ['com_inc3', 'foundation'],
            cflags= ['-std=gnu11', '-mthumb', '-mcpu=cortex-m3' ],
            defines=['STM32MCU_MAJOR_TYPE_F4']
            )
    bld.env.append_value('LIBPATH', bld.path.find_dir('./scripts').abspath() )
    bld.env.CRT0_LINKER_SCRIPT = bld.path.find_resource( './scripts/stm32-f107VBT6.ld' )

